#!/usr/bin/env bash
# of-shell: Open an interactive OpenFOAM-enabled shell inside a container.
#
# Key points:
# - Runs as the current host user (UID/GID mapping).
# - Mounts the current working directory and sets it as workdir.
# - Allocates TTY (-it) for full interactive experience.
# - Uses "bash -i" so OpenFOAM shell functions are available.
#
# Usage:
#   of-shell
#   of-shell <command> [args...]

set -euo pipefail

ENGINE="${OPENFOAM_ENGINE:-docker}"   # Container engine (docker or podman)
IMAGE="${OPENFOAM_IMAGE:-docker.io/opencfd/openfoam-default}"
TAG="${OPENFOAM_TAG:-2406}"

UID="$(id -u)"
GID="$(id -g)"

exec "${ENGINE}" run --rm -it \
  --user "${UID}:${GID}" \
  -v "$PWD:$PWD" -w "$PWD" \
  "${IMAGE}:${TAG}" \
  -- bash -i "$@"

